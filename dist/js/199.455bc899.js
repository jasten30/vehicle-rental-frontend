"use strict";(self["webpackChunkvehicle_rental_frontend"]=self["webpackChunkvehicle_rental_frontend"]||[]).push([[199],{2199:function(e,t,s){s.r(t),s.d(t,{default:function(){return O}});var o=s(6768),l=s(4232),r=s(5130);const a={class:"admin-reports-container"},i={key:0,class:"info-state"},n={key:1,class:"info-state error-state"},c={key:2,class:"info-state"},d={key:3,class:"table-wrapper"},p={class:"reports-table"},u={class:"table-body"},h={class:"action-cell"},k=["onClick"],v={class:"modal-card"},g={class:"report-meta"},L={class:"modal-content"},R={class:"detail-group"},b={class:"detail-group"},C={class:"contact-line"},m={class:"detail-group"},y={class:"contact-line"},f={class:"detail-group"},w={class:"detail-group"},I={class:"detail-group"},_={class:"reason-text"},D={class:"detail-group"},M={class:"modal-actions"};function E(e,t,s,E,A,N){return(0,o.uX)(),(0,o.CE)("div",a,[t[21]||(t[21]=(0,o.Lk)("div",{class:"header-section"},[(0,o.Lk)("h1",{class:"page-title"},"Listing Reports"),(0,o.Lk)("p",{class:"page-subtitle"},"Review and manage user-submitted reports on vehicle listings.")],-1)),A.loading?((0,o.uX)(),(0,o.CE)("div",i,[...t[7]||(t[7]=[(0,o.Lk)("p",null,"Loading reports...",-1)])])):A.errorMessage?((0,o.uX)(),(0,o.CE)("div",n,[(0,o.Lk)("p",null,(0,l.v_)(A.errorMessage),1),(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>N.fetchReports&&N.fetchReports(...e)),class:"button primary"},"Retry")])):0===A.reports.length?((0,o.uX)(),(0,o.CE)("div",c,[...t[8]||(t[8]=[(0,o.Lk)("p",null,"There are currently no reports to review.",-1)])])):((0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("table",p,[t[10]||(t[10]=(0,o.Lk)("thead",{class:"table-header"},[(0,o.Lk)("tr",null,[(0,o.Lk)("th",null,"Date"),(0,o.Lk)("th",null,"Reporter"),(0,o.Lk)("th",null,"Reported Party"),(0,o.eW)(),(0,o.Lk)("th",null,"Vehicle"),(0,o.Lk)("th",null,"Subject"),(0,o.Lk)("th",null,"Status"),(0,o.Lk)("th",null,"Actions")])],-1)),(0,o.Lk)("tbody",u,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(A.reports,e=>((0,o.uX)(),(0,o.CE)("tr",{key:e.id,class:"table-row"},[(0,o.Lk)("td",null,(0,l.v_)(N.formatDate(e.reportedAt)),1),(0,o.Lk)("td",null,(0,l.v_)(e.reporterEmail),1),(0,o.Lk)("td",null,(0,l.v_)(e.reportedPartyName||"N/A"),1),t[9]||(t[9]=(0,o.eW)()),(0,o.Lk)("td",null,(0,l.v_)(e.vehicleMake)+" "+(0,l.v_)(e.vehicleModel),1),(0,o.Lk)("td",null,(0,l.v_)(e.subject),1),(0,o.Lk)("td",null,[(0,o.Lk)("span",{class:(0,l.C4)(["status-badge",`status-${e.status}`])},(0,l.v_)(e.status),3)]),(0,o.Lk)("td",h,[(0,o.Lk)("button",{onClick:t=>N.viewReportDetails(e),class:"button view"},"View Details",8,k)])]))),128))])])])),A.isModalOpen&&A.selectedReport?((0,o.uX)(),(0,o.CE)("div",{key:4,class:"modal-overlay",onClick:t[6]||(t[6]=(0,r.D$)((...e)=>N.closeModal&&N.closeModal(...e),["self"]))},[(0,o.Lk)("div",v,[t[20]||(t[20]=(0,o.Lk)("h3",{class:"modal-title"},"Report Details",-1)),(0,o.Lk)("div",g,[(0,o.Lk)("span",null,"Reported On: "+(0,l.v_)(N.formatDate(A.selectedReport.reportedAt)),1),(0,o.Lk)("span",null,"Booking ID: #"+(0,l.v_)(A.selectedReport.bookingId||"N/A"),1)]),(0,o.Lk)("div",L,[(0,o.Lk)("div",R,[t[11]||(t[11]=(0,o.Lk)("label",null,"Reported Vehicle:",-1)),(0,o.Lk)("p",null,(0,l.v_)(A.selectedReport.vehicleMake)+" "+(0,l.v_)(A.selectedReport.vehicleModel),1)]),(0,o.Lk)("div",b,[t[13]||(t[13]=(0,o.Lk)("label",null,"Reporter Contact:",-1)),(0,o.Lk)("div",C,[(0,o.Lk)("p",null,(0,l.v_)(A.selectedReport.reporterEmail),1),A.selectedReport.reporterId?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:t[1]||(t[1]=e=>N.chatWithUser(A.selectedReport.reporterId,A.selectedReport.reporterEmail)),class:"button chat-icon",title:"Start chat with reporter"},[...t[12]||(t[12]=[(0,o.Lk)("i",{class:"bi bi-chat-dots-fill"},null,-1)])])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",m,[t[15]||(t[15]=(0,o.Lk)("label",null,"Reported Party:",-1)),(0,o.Lk)("div",y,[(0,o.Lk)("p",null,(0,l.v_)(A.selectedReport.reportedPartyName||"N/A"),1),A.selectedReport.reportedPartyId?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:t[2]||(t[2]=e=>N.chatWithUser(A.selectedReport.reportedPartyId,A.selectedReport.reportedPartyName)),class:"button chat-icon",title:"Start chat with reported party"},[...t[14]||(t[14]=[(0,o.Lk)("i",{class:"bi bi-chat-dots-fill"},null,-1)])])):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",f,[t[16]||(t[16]=(0,o.Lk)("label",null,"Booking ID:",-1)),(0,o.Lk)("p",null,(0,l.v_)(A.selectedReport.bookingId||"N/A"),1)]),(0,o.Lk)("div",w,[t[17]||(t[17]=(0,o.Lk)("label",null,"Subject (Reason Code):",-1)),(0,o.Lk)("p",null,(0,l.v_)(A.selectedReport.subject),1)]),(0,o.Lk)("div",I,[t[18]||(t[18]=(0,o.Lk)("label",null,"Full Details:",-1)),(0,o.Lk)("p",_,(0,l.v_)(A.selectedReport.reason),1)]),(0,o.Lk)("div",D,[t[19]||(t[19]=(0,o.Lk)("label",null,"Status:",-1)),(0,o.Lk)("p",null,[(0,o.Lk)("span",{class:(0,l.C4)(["status-badge",`status-${A.selectedReport.status}`])},(0,l.v_)(A.selectedReport.status),3)])])]),(0,o.Lk)("div",M,[A.selectedReport.bookingId?((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:t[3]||(t[3]=(...e)=>N.goToBookingChat&&N.goToBookingChat(...e)),class:"button chat",title:"View chat associated with this booking"}," View Booking Chat ")):(0,o.Q3)("",!0),(0,o.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>N.closeModal&&N.closeModal(...e)),class:"button close"},"Close"),"resolved"!==A.selectedReport.status?((0,o.uX)(),(0,o.CE)("button",{key:1,onClick:t[5]||(t[5]=e=>N.resolveReport(A.selectedReport.id)),class:"button resolve"}," Mark as Resolved ")):(0,o.Q3)("",!0)])])])):(0,o.Q3)("",!0)])}s(4114),s(8111),s(116);var A=s(782),N=s(8340),X={name:"AdminReportsView",data(){return{loading:!0,reports:[],selectedReport:null,isModalOpen:!1,errorMessage:null,isChatting:!1}},computed:{},methods:{...(0,A.i0)(["fetchBookingReports","resolveBookingReport","findOrCreateAdminUserChat"]),async fetchReports(){this.loading=!0,this.errorMessage=null;try{const e=await this.fetchBookingReports();this.reports=e}catch(e){console.error("Error fetching reports:",e),this.errorMessage="Failed to load reports. Please try again.",this.reports=[]}finally{this.loading=!1}},formatDate(e){if(!e)return"N/A";try{const t=e.toDate?e.toDate():new Date(e);return isNaN(t.getTime())?"Invalid Date":N.c9.fromJSDate(t).toFormat("LLL dd, yyyy")}catch(t){return console.warn("Error formatting date:",e,t),"Invalid Date"}},viewReportDetails(e){this.selectedReport=e,this.isModalOpen=!0},closeModal(){this.isModalOpen=!1,this.selectedReport=null},async resolveReport(e){console.log(`Attempting to resolve report ${e}...`);try{await this.resolveBookingReport(e);const t=this.reports.find(t=>t.id===e);t&&(t.status="resolved"),this.closeModal(),alert("Report marked as resolved.")}catch(t){console.error(`Error resolving report ${e}:`,t),alert(`Failed to resolve report: ${t.response?.data?.message||t.message}`)}},goToBookingChat(){this.selectedReport&&this.selectedReport.bookingId?(this.$router.push({name:"ChatConversation",params:{chatId:this.selectedReport.bookingId}}),this.closeModal()):(console.warn("Cannot navigate to chat: bookingId is missing from the selected report."),alert("Booking ID is missing for this report, cannot open chat."))},async chatWithUser(e,t){if(e){this.isChatting=!0,console.log(`ADMIN ACTION: Finding/Creating chat for report ${this.selectedReport?.id} with user ${t||"Unknown"} (ID: ${e})`);try{const t=await this.findOrCreateAdminUserChat(e);if(!t)throw new Error("Chat ID was not returned.");this.$router.push({name:"ChatConversation",params:{chatId:t}}),this.closeModal()}catch(s){console.error("Error initiating admin-user chat:",s),alert(`Could not open or create chat: ${s.response?.data?.message||s.message}`)}finally{this.isChatting=!1}}else alert("Cannot initiate chat: User ID is missing.")}},created(){this.fetchReports()}},$=s(1241);const B=(0,$.A)(X,[["render",E],["__scopeId","data-v-1b7d5ee8"]]);var O=B}}]);
//# sourceMappingURL=199.455bc899.js.map